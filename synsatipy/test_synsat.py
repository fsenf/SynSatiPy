from synsat_test import SynSatTest
import numpy as np


def test_synsat_on_test_profile(accuracy=1.0):
    """
    Runs the SynSatTest on predefined profiles.

    Parameters
    ----------
    accuracy :
         (Default value = 1.0)

    Returns
    -------


    Notes
    -----
    The test will fail when profiles are changed because expected result is hardcoded.
    """

    kwargs = dict(synsat_channel_list=(1, 2, 3, 4, 5, 6, 7, 9, 10, 11))
    s = SynSatTest(**kwargs)
    s.run_workflow()

    target = np.array(
        [
            [
                5.73808550e-02,
                2.27539811e-01,
                1.35243067e-01,
                2.71376351e02,
                2.31071751e02,
                2.48525205e02,
                2.65588312e02,
                2.67568685e02,
                2.67310265e02,
                2.53160358e02,
            ],
            [
                5.73817456e-02,
                2.27556584e-01,
                1.35235128e-01,
                2.71479406e02,
                2.32085280e02,
                2.49334519e02,
                2.65681963e02,
                2.67613130e02,
                2.67387016e02,
                2.53553273e02,
            ],
            [
                5.73826320e-02,
                2.27573351e-01,
                1.35227234e-01,
                2.71586252e02,
                2.33098733e02,
                2.50148545e02,
                2.65778029e02,
                2.67658487e02,
                2.67464727e02,
                2.53953613e02,
            ],
            [
                5.73835148e-02,
                2.27590113e-01,
                1.35219388e-01,
                2.71697010e02,
                2.34112110e02,
                2.50967155e02,
                2.65876542e02,
                2.67705102e02,
                2.67543448e02,
                2.54361402e02,
            ],
            [
                5.73843942e-02,
                2.27606871e-01,
                1.35211589e-01,
                2.71811802e02,
                2.35125409e02,
                2.51790224e02,
                2.65977534e02,
                2.67752442e02,
                2.67623225e02,
                2.54776662e02,
            ],
            [
                5.73852706e-02,
                2.27623625e-01,
                1.35203841e-01,
                2.71930752e02,
                2.36138630e02,
                2.52617629e02,
                2.66081035e02,
                2.67800834e02,
                2.67704106e02,
                2.55199408e02,
            ],
            [
                5.73861445e-02,
                2.27640378e-01,
                1.35196143e-01,
                2.72053982e02,
                2.37151773e02,
                2.53449251e02,
                2.66187078e02,
                2.67850325e02,
                2.67786136e02,
                2.55629652e02,
            ],
            [
                5.73870162e-02,
                2.27657129e-01,
                1.35188497e-01,
                2.72181615e02,
                2.38164837e02,
                2.54284975e02,
                2.66295694e02,
                2.67901328e02,
                2.67869362e02,
                2.56067403e02,
            ],
        ]
    )

    eps = np.abs(s.BtRefl - target).max()

    assert eps < accuracy
